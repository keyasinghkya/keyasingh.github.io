<div class="gallery-box border-4 border-neutral-300 dark:border-neutral-600 rounded-lg p-6 my-8">
  {{ if .Get "title" }}
  <h3 class="gallery-title text-xl font-bold mb-1">{{ .Get "title" }}</h3>
  {{ end }}

  {{ if or (.Get "location") (.Get "date") }}
  <p class="gallery-location text-sm mb-2">
    {{ if .Get "location" }}{{ .Get "location" }}{{ end }}
    {{ if and (.Get "location") (.Get "date") }}, {{ end }}
    {{ if .Get "date" }}{{ .Get "date" }}{{ end }}
  </p>
  {{ end }}

  {{ if .Get "description" }}
  <p class="gallery-description text-sm mb-2">{{ .Get "description" }}</p>
  {{ end }}

  {{ if .Get "credits" }}
  <p class="gallery-credits text-xs italic mb-4">{{ .Get "credits" }}</p>
  {{ end }}

  <div class="image-gallery">
    {{ $imagesParam := .Get "images" | default "" }}
    {{ $vimeosParam := .Get "vimeos" | default "" }}
    {{ $tumblrsParam := .Get "tumblrs" | default "" }}
    {{ $captionsParam := .Get "captions" | default "" }}

    {{ $images := cond (ne $imagesParam "") (split $imagesParam ",") (slice) }}
    {{ $vimeos := cond (ne $vimeosParam "") (split $vimeosParam ",") (slice) }}
    {{ $tumblrs := cond (ne $tumblrsParam "") (split $tumblrsParam ",") (slice) }}
    {{ $captions := cond (ne $captionsParam "") (split $captionsParam "|") (slice) }}

    {{ $maxLen := len $images }}
    {{ if gt (len $vimeos) $maxLen }}{{ $maxLen = len $vimeos }}{{ end }}
    {{ if gt (len $tumblrs) $maxLen }}{{ $maxLen = len $tumblrs }}{{ end }}

    {{ range $index := seq 0 (sub $maxLen 1) }}
      {{ $image := "" }}
      {{ if lt $index (len $images) }}{{ $image = trim (index $images $index) " " }}{{ end }}

      {{ $vimeoID := "" }}
      {{ if lt $index (len $vimeos) }}{{ $vimeoID = trim (index $vimeos $index) " " }}{{ end }}

      {{ $tumblr := "" }}
      {{ if lt $index (len $tumblrs) }}{{ $tumblr = trim (index $tumblrs $index) " " }}{{ end }}

      {{ $caption := "" }}
      {{ if lt $index (len $captions) }}{{ $caption = index $captions $index }}{{ end }}

      <div class="gallery-item">
        {{ if ne $vimeoID "" }}
          <div class="video-embed">
            <iframe src="https://player.vimeo.com/video/{{ $vimeoID }}"
                    frameborder="0"
                    allow="autoplay; fullscreen; picture-in-picture"
                    allowfullscreen>
            </iframe>
          </div>
        {{ else if ne $tumblr "" }}
          <div class="video-embed">
            <video controls preload="metadata">
              <source src="{{ $tumblr }}" type="video/mp4">
            </video>
          </div>
        {{ else if ne $image "" }}
          {{ if or (strings.HasSuffix $image ".mp4") (strings.HasSuffix $image ".mov") }}
            <div class="video-embed">
              <video controls preload="metadata">
                <source src="{{ $image }}" type="video/mp4">
              </video>
            </div>
          {{ else }}
            <img src="{{ $image }}" alt="" loading="lazy" decoding="async">
          {{ end }}
        {{ end }}

        {{ if ne $caption "" }}
        <p class="image-caption">{{ $caption }}</p>
        {{ end }}
      </div>
    {{ end }}
  </div>
</div>

<style>
  .gallery-title {
    color: white;
    text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.9), 0 0 20px rgba(0, 0, 0, 0.8);
  }

  .gallery-location {
    color: rgb(var(--color-primary-400));
    text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.9), 0 0 10px rgba(0, 0, 0, 0.7);
  }

  .dark .gallery-location {
    color: rgb(var(--color-primary-300));
  }

  .gallery-description {
    color: rgba(255, 255, 255, 0.95);
    text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.9);
  }

  .dark .gallery-description {
    color: rgba(255, 255, 255, 0.9);
  }

  .gallery-credits {
    color: rgba(255, 255, 255, 0.8);
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.9);
  }

  .dark .gallery-credits {
    color: rgba(255, 255, 255, 0.7);
  }

  .image-gallery {
    display: flex;
    overflow-x: auto;
    gap: 1rem;
    padding: 0rem 0 1rem 0;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
  }

  .gallery-item {
    flex-shrink: 0;
    scroll-snap-align: start;
  }

  .image-gallery img {
    height: 600px;
    min-width: 450px;
    object-fit: cover;
    border-radius: 8px;
    display: block;
  }

  .video-embed {
    height: 600px;
    min-width: 800px;
    border-radius: 8px;
    overflow: hidden;
    background: black;
  }

  .video-embed iframe,
  .video-embed video {
    width: 100%;
    height: 100%;
  }

  .image-caption {
    margin-top: 0.5rem;
    font-size: 0.875rem;
    color: rgb(var(--color-neutral-600));
    max-width: 800px;
  }

  .dark .image-caption {
    color: rgb(var(--color-neutral-400));
  }

  @media (max-width: 768px) {
    .image-gallery img,
    .video-embed {
      height: 400px;
      min-width: 300px;
    }
    .image-caption {
      max-width: 300px;
    }
  }

  @media (max-width: 480px) {
    .image-gallery img,
    .video-embed {
      height: 300px;
      min-width: 250px;
    }
    .image-caption {
      max-width: 250px;
    }
  }

  .image-gallery::-webkit-scrollbar {
    height: 8px;
  }

  .image-gallery::-webkit-scrollbar-track {
    background: rgba(0,0,0,0.1);
    border-radius: 10px;
  }

  .image-gallery::-webkit-scrollbar-thumb {
    background: rgba(0,0,0,0.3);
    border-radius: 10px;
  }
</style>
